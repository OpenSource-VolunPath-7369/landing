<div class="register-container">
  <div class="register-card">
    <!-- Logo -->
    <div class="logo-section">
      <div class="logo-box">
        <img src="/assets/volunpath-logo.png" 
             alt="Volunpath Logo" 
             class="logo-image"
             (error)="onLogoError($event)">
      </div>
    </div>

    <!-- Title -->
    <div class="title-section">
      <h1 class="register-title">Crear cuenta</h1>
    </div>

    <!-- Tipo de usuario -->
    <div class="form-section">
      <mat-form-field appearance="fill" class="full-width">
        <mat-label>Registrarse como</mat-label>
        <mat-select [value]="userType" (selectionChange)="userType = $event.value; onUserTypeChange()">
          <mat-option value="volunteer">Voluntario</mat-option>
          <mat-option value="organization">Organización</mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <!-- Register Form -->
    <form [formGroup]="registerForm" (ngSubmit)="onSubmit()" class="register-form">
      
      <!-- Formulario de Voluntario -->
      <div *ngIf="userType === 'volunteer'">
        <div class="form-section">
          <h3 class="section-title">*Datos personales</h3>
          
          <!-- Campo de imagen de perfil -->
          <div class="image-upload-section">
            <label class="image-upload-label">Foto de perfil (opcional)</label>
            <div class="image-upload-container">
              <!-- Estado de carga -->
              <div *ngIf="imageLoading" class="image-loading">
                <div class="spinner"></div>
                <p class="loading-text">Procesando imagen...</p>
              </div>
              
              <div class="image-preview" *ngIf="selectedImage && !imageLoading">
                <img [src]="selectedImage" alt="Vista previa" class="preview-image">
                <button type="button" mat-icon-button class="remove-image-btn" (click)="removeImage()" title="Eliminar imagen">
                  <mat-icon>close</mat-icon>
                </button>
              </div>
              <div class="image-upload-placeholder" *ngIf="!selectedImage && !imageLoading">
                <mat-icon class="upload-icon">cloud_upload</mat-icon>
                <p class="upload-text">Haz clic para subir una imagen</p>
                <p class="upload-hint">JPG, PNG, GIF o WEBP (máx. 5MB)</p>
              </div>
              <input type="file" 
                     accept="image/jpeg,image/jpg,image/png,image/gif,image/webp"
                     (change)="onImageSelected($event)"
                     class="file-input"
                     id="avatar-upload"
                     [disabled]="imageLoading">
              <label for="avatar-upload" 
                     class="file-input-label"
                     [class.disabled]="imageLoading">
                <mat-icon>add_photo_alternate</mat-icon>
                {{ selectedImage ? 'Cambiar imagen' : 'Seleccionar imagen' }}
              </label>
            </div>
          </div>

          <!-- Nombre y Ubicación lado a lado -->
          <div class="form-row">
            <mat-form-field appearance="fill" class="form-field-half">
              <mat-label>Nombre completo</mat-label>
              <mat-icon matPrefix>person</mat-icon>
              <input matInput 
                     formControlName="name">
              <mat-error *ngIf="registerForm.get('name')?.hasError('required')">
                El nombre es requerido
              </mat-error>
              <mat-error *ngIf="registerForm.get('name')?.hasError('minlength')">
                El nombre debe tener al menos 3 caracteres
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="fill" class="form-field-half">
              <mat-label>Ubicación</mat-label>
              <mat-icon matPrefix>location_on</mat-icon>
              <input matInput 
                     formControlName="location">
              <mat-error *ngIf="registerForm.get('location')?.hasError('required')">
                La ubicación es requerida
              </mat-error>
            </mat-form-field>
          </div>

          <!-- Correo electrónico solo -->
          <mat-form-field appearance="fill" class="full-width">
            <mat-label>Correo electrónico</mat-label>
            <mat-icon matPrefix>email</mat-icon>
            <input matInput 
                   type="email"
                   formControlName="email">
            <mat-error *ngIf="registerForm.get('email')?.hasError('required')">
              El correo es requerido
            </mat-error>
            <mat-error *ngIf="registerForm.get('email')?.hasError('email')">
              Ingresa un correo válido
            </mat-error>
          </mat-form-field>

          <!-- Contraseña y Confirmar contraseña lado a lado -->
          <div class="form-row">
            <mat-form-field appearance="fill" class="form-field-half">
              <mat-label>Contraseña</mat-label>
              <mat-icon matPrefix>lock</mat-icon>
              <input matInput 
                     type="password"
                     formControlName="password">
              <mat-error *ngIf="registerForm.get('password')?.hasError('required')">
                La contraseña es requerida
              </mat-error>
              <mat-error *ngIf="registerForm.get('password')?.hasError('minlength')">
                La contraseña debe tener al menos 6 caracteres
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="fill" class="form-field-half">
              <mat-label>Confirmar contraseña</mat-label>
              <mat-icon matPrefix>lock</mat-icon>
              <input matInput 
                     type="password"
                     formControlName="confirmPassword">
              <mat-error *ngIf="registerForm.get('confirmPassword')?.hasError('required')">
                Debes confirmar la contraseña
              </mat-error>
              <mat-error *ngIf="registerForm.get('confirmPassword')?.hasError('passwordMismatch')">
                Las contraseñas no coinciden
              </mat-error>
            </mat-form-field>
          </div>

          <mat-form-field appearance="fill" class="full-width">
            <mat-label>Biografía (opcional)</mat-label>
            <textarea matInput 
                      formControlName="bio" 
                      rows="2"></textarea>
            <mat-error *ngIf="registerForm.get('bio')?.hasError('maxlength')">
              La biografía no puede exceder 500 caracteres
            </mat-error>
          </mat-form-field>
        </div>
      </div>

      <!-- Formulario de Organización -->
      <div *ngIf="userType === 'organization'">
        <!-- Campo de imagen de perfil para organización -->
        <div class="form-section">
          <div class="image-upload-section">
            <label class="image-upload-label">Logo de la organización (opcional)</label>
            <div class="image-upload-container">
              <!-- Estado de carga -->
              <div *ngIf="imageLoading" class="image-loading">
                <div class="spinner"></div>
                <p class="loading-text">Procesando imagen...</p>
              </div>
              
              <div class="image-preview" *ngIf="selectedImage && !imageLoading">
                <img [src]="selectedImage" alt="Vista previa" class="preview-image">
                <button type="button" mat-icon-button class="remove-image-btn" (click)="removeImage()" title="Eliminar imagen">
                  <mat-icon>close</mat-icon>
                </button>
              </div>
              <div class="image-upload-placeholder" *ngIf="!selectedImage && !imageLoading">
                <mat-icon class="upload-icon">cloud_upload</mat-icon>
                <p class="upload-text">Haz clic para subir un logo</p>
                <p class="upload-hint">JPG, PNG, GIF o WEBP (máx. 5MB)</p>
              </div>
              <input type="file" 
                     accept="image/jpeg,image/jpg,image/png,image/gif,image/webp"
                     (change)="onImageSelected($event)"
                     class="file-input"
                     id="org-logo-upload"
                     [disabled]="imageLoading">
              <label for="org-logo-upload" 
                     class="file-input-label"
                     [class.disabled]="imageLoading">
                <mat-icon>add_photo_alternate</mat-icon>
                {{ selectedImage ? 'Cambiar logo' : 'Seleccionar logo' }}
              </label>
            </div>
          </div>
        </div>

        <!-- Datos de la organización -->
        <div class="form-section">
          <h3 class="section-title">*Datos de la organización</h3>
        
        <mat-form-field appearance="fill" class="full-width">
          <mat-label>Nombre de organización</mat-label>
          <mat-icon matPrefix>business</mat-icon>
          <input matInput 
                 formControlName="organizationName">
          <mat-error *ngIf="registerForm.get('organizationName')?.hasError('required')">
            El nombre es requerido
          </mat-error>
          <mat-error *ngIf="registerForm.get('organizationName')?.hasError('minlength')">
            El nombre debe tener al menos 3 caracteres
          </mat-error>
        </mat-form-field>
      </div>

      <!-- Tipo de organización -->
      <div class="form-section">
        <h3 class="section-title">Tipo de organización:</h3>
        
        <mat-radio-group formControlName="organizationType" class="radio-group">
          <mat-radio-button value="ONG" class="radio-option">ONG</mat-radio-button>
          <mat-radio-button value="Organización Social" class="radio-option">Organización Social</mat-radio-button>
          <mat-radio-button value="Organización Juvenil" class="radio-option">Organización Juvenil</mat-radio-button>
          <mat-radio-button value="Organización Voluntariado" class="radio-option">Organización Voluntariado</mat-radio-button>
        </mat-radio-group>
        <mat-error *ngIf="registerForm.get('organizationType')?.hasError('required') && registerForm.get('organizationType')?.touched">
          Debes seleccionar un tipo de organización
        </mat-error>
      </div>

      <!-- Campos adicionales de organización -->
      <div class="form-section">
        <!-- Distrito y Correo lado a lado -->
        <div class="form-row">
          <mat-form-field appearance="fill" class="form-field-half">
            <mat-label>Distrito - Provincia</mat-label>
            <mat-icon matPrefix>location_on</mat-icon>
            <input matInput 
                   formControlName="district">
            <mat-error *ngIf="registerForm.get('district')?.hasError('required')">
              El distrito es requerido
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="fill" class="form-field-half">
            <mat-label>Correo de la organización</mat-label>
            <mat-icon matPrefix>email</mat-icon>
            <input matInput 
                   type="email"
                   formControlName="organizationEmail">
            <mat-error *ngIf="registerForm.get('organizationEmail')?.hasError('required')">
              El correo es requerido
            </mat-error>
            <mat-error *ngIf="registerForm.get('organizationEmail')?.hasError('email')">
              Ingresa un correo válido
            </mat-error>
          </mat-form-field>
        </div>

        <mat-form-field appearance="fill" class="full-width">
          <mat-label>Teléfono de la organización</mat-label>
          <mat-icon matPrefix>phone</mat-icon>
          <input matInput 
                 formControlName="organizationPhone">
          <mat-error *ngIf="registerForm.get('organizationPhone')?.hasError('required')">
            El teléfono es requerido
          </mat-error>
        </mat-form-field>
      </div>

      <!-- Datos del representante -->
      <div class="form-section">
        <h3 class="section-title">*Datos del representante</h3>
        
        <!-- Nombre y Correo lado a lado -->
        <div class="form-row">
          <mat-form-field appearance="fill" class="form-field-half">
            <mat-label>Nombre del representante</mat-label>
            <mat-icon matPrefix>person</mat-icon>
            <input matInput 
                   formControlName="representativeName">
            <mat-error *ngIf="registerForm.get('representativeName')?.hasError('required')">
              El nombre es requerido
            </mat-error>
            <mat-error *ngIf="registerForm.get('representativeName')?.hasError('minlength')">
              El nombre debe tener al menos 3 caracteres
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="fill" class="form-field-half">
            <mat-label>Correo del representante</mat-label>
            <mat-icon matPrefix>email</mat-icon>
            <input matInput 
                   type="email"
                   formControlName="representativeEmail">
            <mat-error *ngIf="registerForm.get('representativeEmail')?.hasError('required')">
              El correo es requerido
            </mat-error>
            <mat-error *ngIf="registerForm.get('representativeEmail')?.hasError('email')">
              Ingresa un correo válido
            </mat-error>
          </mat-form-field>
        </div>

        <!-- Contraseña y Confirmar contraseña lado a lado -->
        <div class="form-row">
          <mat-form-field appearance="fill" class="form-field-half">
            <mat-label>Contraseña</mat-label>
            <mat-icon matPrefix>lock</mat-icon>
            <input matInput 
                   type="password"
                   formControlName="password">
            <mat-error *ngIf="registerForm.get('password')?.hasError('required')">
              La contraseña es requerida
            </mat-error>
            <mat-error *ngIf="registerForm.get('password')?.hasError('minlength')">
              La contraseña debe tener al menos 6 caracteres
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="fill" class="form-field-half">
            <mat-label>Confirmar contraseña</mat-label>
            <mat-icon matPrefix>lock</mat-icon>
            <input matInput 
                   type="password"
                   formControlName="confirmPassword">
            <mat-error *ngIf="registerForm.get('confirmPassword')?.hasError('required')">
              Debes confirmar la contraseña
            </mat-error>
            <mat-error *ngIf="registerForm.get('confirmPassword')?.hasError('passwordMismatch')">
              Las contraseñas no coinciden
            </mat-error>
          </mat-form-field>
        </div>
      </div>
      </div>

      <!-- Action Buttons -->
      <div class="form-actions">
        <button mat-button 
                type="button"
                (click)="onCancel()"
                class="cancel-button">
          Cancelar
        </button>
        <button mat-raised-button 
                color="primary" 
                type="submit"
                class="register-button"
                [disabled]="registerForm.invalid">
          <mat-icon>how_to_reg</mat-icon>
          {{ userType === 'volunteer' ? 'Registrarse como Voluntario' : 'Registrar Organización' }}
        </button>
      </div>
    </form>
  </div>
</div>


