<div class="notifications-container">
  <div class="notifications-header">
    <h1 class="notifications-title">{{ 'notifications.title' | translate }}</h1>
  </div>
  
  <!-- Estados de carga y error -->
  <div *ngIf="loading" class="flex justify-center items-center py-12">
    <div class="text-center">
      <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"></div>
      <p class="mt-4 text-gray-600">{{ 'notifications.loading' | translate }}</p>
    </div>
  </div>

  <div *ngIf="error && !loading" class="text-center py-12">
    <div class="text-red-600 mb-4">
      <svg class="mx-auto h-12 w-12" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 19.5c-.77.833.192 2.5 1.732 2.5z" />
      </svg>
    </div>
    <h3 class="text-lg font-medium text-gray-900 mb-2">{{ 'notifications.errorLoading' | translate }}</h3>
    <p class="text-gray-600 mb-4">{{ error }}</p>
    <button 
      (click)="retry()" 
      class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700">
      {{ 'common.retry' | translate }}
    </button>
  </div>
  
  <div *ngIf="!loading && !error" class="notifications-list">
    <!-- Debug info (temporal) -->
    <div *ngIf="notifications.length === 0" class="mb-4 p-4 bg-yellow-50 border border-yellow-200 rounded">
      <p class="text-sm text-yellow-800">
        <strong>Debug:</strong> No se encontraron notificaciones. 
        Usuario ID: {{ currentUser?.id }}, 
        Rol: {{ currentUser?.role }}, 
        Email: {{ currentUser?.email }}
      </p>
    </div>
    
    <div 
      *ngFor="let notification of notifications" 
      class="notification-item"
      [class.unread]="notification.isUnread()"
      [class.clickable]="true"
      (click)="onNotificationClick(notification)"
      [title]="'notifications.clickToView' | translate">
      
      <div class="notification-icon">
        <i *ngIf="notification.type === 'new_activity'" 
           class="fa-solid fa-hand-holding-heart fa-icon"></i>
        <i *ngIf="notification.type === 'new_message'" 
           class="fa-solid fa-envelope fa-icon"></i>
        <i *ngIf="notification.type === 'activity_confirmed'" 
           class="fa-solid fa-check-circle fa-icon"></i>
        <i *ngIf="notification.type === 'activity_cancelled'" 
           class="fa-solid fa-times-circle fa-icon"></i>
        <i *ngIf="notification.type === 'general'" 
           class="fa-solid fa-bell fa-icon"></i>
      </div>
      
      <div class="notification-content">
        <div class="notification-text">
          <span class="notification-title">{{ notification.title }}</span>
          <span class="notification-message">{{ notification.message }}</span>
        </div>
      </div>
    </div>
    
    <div *ngIf="notifications.length === 0" class="empty-state">
      <p>No hay notificaciones</p>
    </div>
  </div>
</div>

<!-- Modal de Mensaje Completo -->
<div *ngIf="showMessageModal" class="message-modal-overlay" (click)="closeMessageModal()">
  <div class="message-modal-content" (click)="$event.stopPropagation()">
    <div class="message-modal-header">
      <h2 class="message-modal-title">Mensaje</h2>
      <button class="message-modal-close" (click)="closeMessageModal()" type="button">
        <i class="fa-solid fa-times"></i>
      </button>
    </div>
    
    <div class="message-modal-body" *ngIf="selectedMessage">
      <!-- InformaciÃ³n del remitente -->
      <div class="message-sender-info">
        <img [src]="selectedMessage.senderIcon" 
             [alt]="selectedMessage.senderName" 
             class="sender-avatar"
             onerror="this.src='/assets/mundo.png'">
        <div class="sender-details">
          <h3 class="sender-name">{{ selectedMessage.senderName }}</h3>
          <p class="message-date">{{ selectedMessage.timestamp | date:'medium' }}</p>
        </div>
      </div>
      
      <!-- Contenido del mensaje -->
      <div class="message-content">
        <p class="message-text">{{ selectedMessage.content }}</p>
      </div>
      
      <!-- Formulario de respuesta -->
      <div class="reply-section">
        <h4 class="reply-title">Responder</h4>
        <form [formGroup]="replyForm" (ngSubmit)="sendReply()">
          <mat-form-field appearance="fill" class="full-width">
            <mat-label>Escribe tu respuesta...</mat-label>
            <textarea matInput 
                      formControlName="content" 
                      rows="4"></textarea>
            <mat-error *ngIf="replyForm.get('content')?.hasError('required')">
              El mensaje es requerido
            </mat-error>
          </mat-form-field>
          
          <div class="reply-actions">
            <button mat-button 
                    type="button" 
                    (click)="closeMessageModal()"
                    [disabled]="sendingReply">
              Cancelar
            </button>
            <button mat-raised-button 
                    color="primary" 
                    type="submit"
                    [disabled]="replyForm.invalid || sendingReply">
              <span *ngIf="!sendingReply">Enviar Respuesta</span>
              <span *ngIf="sendingReply">
                <i class="fa-solid fa-spinner fa-spin"></i> Enviando...
              </span>
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>


