<div class="form-container">
  <div class="form-header">
    <h1 class="form-title">Nueva Publicación</h1>
    <p class="form-subtitle">Comparte una nueva actividad con la comunidad y conecta con otros voluntarios</p>
  </div>

  <!-- Estados de carga y error -->
  <div *ngIf="loading" class="flex justify-center items-center py-12">
    <div class="text-center">
      <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"></div>
      <p class="mt-4 text-gray-600">Cargando organizaciones...</p>
    </div>
  </div>

  <div *ngIf="error && !loading" class="text-center py-12">
    <div class="text-red-600 mb-4">
      <svg class="mx-auto h-12 w-12" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 19.5c-.77.833.192 2.5 1.732 2.5z" />
      </svg>
    </div>
    <h3 class="text-lg font-medium text-gray-900 mb-2">Error al cargar organizaciones</h3>
    <p class="text-gray-600 mb-4">{{ error }}</p>
    <button 
      (click)="retry()" 
      class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
      <svg class="-ml-1 mr-2 h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
      </svg>
      Reintentar
    </button>
  </div>

  <mat-card class="publication-form" *ngIf="!loading && !error">
    <mat-card-content>
      <form [formGroup]="publicationForm" (ngSubmit)="onSubmit()">
        <!-- Título -->
        <mat-form-field appearance="fill" class="full-width">
          <mat-label>Título *</mat-label>
          <input matInput formControlName="title">
          <mat-error *ngIf="publicationForm.get('title')?.hasError('required')">
            El título es requerido
          </mat-error>
          <mat-error *ngIf="publicationForm.get('title')?.hasError('minlength')">
            El título debe tener al menos 5 caracteres
          </mat-error>
        </mat-form-field>

        <!-- Descripción -->
        <mat-form-field appearance="fill" class="full-width">
          <mat-label>Descripción *</mat-label>
          <textarea matInput formControlName="description" 
                    rows="4"></textarea>
          <mat-error *ngIf="publicationForm.get('description')?.hasError('required')">
            La descripción es requerida
          </mat-error>
          <mat-error *ngIf="publicationForm.get('description')?.hasError('minlength')">
            La descripción debe tener al menos 20 caracteres
          </mat-error>
        </mat-form-field>

        <!-- Imagen -->
        <div class="image-upload-section">
          <input
            type="file"
            id="image"
            (change)="onImageSelected($event)"
            accept="image/*"
            class="file-input">
          
          <div style="text-align: center;">
            <button mat-raised-button color="primary" type="button" (click)="selectImage()" 
                    style="margin-bottom: 16px;">
              <mat-icon>camera_alt</mat-icon>
              Seleccionar imagen
            </button>
            <p style="color: #6b7280; font-size: 0.9rem; margin: 0;">
              Formatos soportados: JPG, PNG, GIF (máx. 5MB)
            </p>
          </div>
          
          <!-- Preview de imagen -->
          <div *ngIf="imagePreview" class="image-preview">
            <img [src]="imagePreview" alt="Preview" class="preview-image">
            <button mat-icon-button color="warn" type="button" (click)="removeImage()" class="remove-image-btn">
              <mat-icon>close</mat-icon>
            </button>
          </div>
        </div>

        <!-- Organización -->
        <mat-form-field appearance="fill" class="full-width">
          <mat-label>Organización *</mat-label>
          <mat-select formControlName="organizationId">
            <mat-option *ngFor="let org of organizations" [value]="org.id">
              {{ org.name }}
            </mat-option>
          </mat-select>
          <mat-error *ngIf="publicationForm.get('organizationId')?.hasError('required')">
            La organización es requerida
          </mat-error>
        </mat-form-field>

        <!-- Tags -->
        <mat-form-field appearance="fill" class="full-width">
          <mat-label>Tags</mat-label>
          <input matInput formControlName="tags">
          <mat-hint>Agrega etiquetas para que tu publicación sea más fácil de encontrar</mat-hint>
        </mat-form-field>

        <!-- Configuraciones adicionales -->
        <div class="checkbox-section">
          <mat-checkbox formControlName="isPublic">
            Hacer pública
          </mat-checkbox>
          <p style="color: #6b7280; font-size: 0.9rem; margin: 8px 0 0 0;">
            Las publicaciones públicas son visibles para todos los miembros de la comunidad
          </p>
        </div>

        <!-- Fecha programada -->
        <mat-form-field appearance="fill" class="full-width">
          <mat-label>Fecha programada (opcional)</mat-label>
          <input matInput [matDatepicker]="picker" formControlName="scheduledDate">
          <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
        </mat-form-field>
      </form>
    </mat-card-content>

    <mat-card-actions align="end">
      <button mat-button (click)="onCancel()" [disabled]="submitting">
        <mat-icon>arrow_back</mat-icon>
        Cancelar
      </button>
      <button mat-raised-button color="primary" 
              [disabled]="!isFormValid"
              (click)="onSubmit()">
        <mat-icon *ngIf="!submitting">publish</mat-icon>
        <mat-icon *ngIf="submitting" class="animate-spin">refresh</mat-icon>
        {{ submitting ? 'Creando...' : 'Crear Publicación' }}
      </button>
    </mat-card-actions>
  </mat-card>
</div>
