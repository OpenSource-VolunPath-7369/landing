<div class="profile-container">
  <div class="profile-header">
    <h1 class="profile-title">{{ 'profile.title' | translate }}</h1>
  </div>
  
  <!-- Estado de carga -->
  <div *ngIf="loading && !isEditing" class="flex justify-center items-center py-12">
    <div class="text-center">
      <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"></div>
      <p class="mt-4 text-gray-600">{{ 'profile.loading' | translate }}</p>
    </div>
  </div>

  <div class="profile-icon-section">
    <div class="thematic-icon">
      <div class="icon-circle">
        <!-- Foto del usuario para voluntarios -->
        <img *ngIf="isVolunteerMode && volunteerProfile.avatar" 
             [src]="volunteerProfile.avatar" 
             [alt]="volunteerProfile.name"
             class="user-avatar-image"
             onerror="this.src='/assets/mundo.png'">
        <!-- Logo de la organización -->
        <img *ngIf="!isVolunteerMode && profile.organization.logo" 
             [src]="profile.organization.logo" 
             [alt]="profile.organization.name"
             class="user-avatar-image"
             onerror="this.src='/assets/mundo.png'">
        <!-- Icono genérico solo si no hay foto de voluntario ni logo de organización -->
        <img *ngIf="(!isVolunteerMode && !profile.organization.logo) || (isVolunteerMode && !volunteerProfile.avatar)" 
             src="/assets/mundo.png" 
             alt="Icono" 
             class="world-image">
      </div>
    </div>
  </div>

  <mat-card class="profile-card" *ngIf="!loading || isEditing">
    <mat-card-content>
      <!-- PERFIL DE VOLUNTARIO -->
      <div *ngIf="isVolunteerMode">
        <!-- Modo de visualización -->
        <div *ngIf="!isEditing">
          <!-- Información del voluntario -->
          <div class="section">
            <h3 class="section-title">{{ 'profile.personalData' | translate }}</h3>
            <div class="data-grid">
              <div class="data-item">
                <span class="data-label">{{ 'profile.name' | translate }}</span>
                <span class="data-value">{{ volunteerProfile.name }}</span>
              </div>
              <div class="data-item">
                <span class="data-label">{{ 'profile.email' | translate }}</span>
                <span class="data-value">{{ volunteerProfile.email }}</span>
              </div>
              <div class="data-item">
                <span class="data-label">{{ 'profile.location' | translate }}</span>
                <span class="data-value">{{ volunteerProfile.location }}</span>
              </div>
              <div class="data-item">
                <span class="data-label">{{ 'profile.joinedDate' | translate }}:</span>
                <span class="data-value">{{ volunteerProfile.joinedDate | date:'dd/MM/yyyy' }}</span>
              </div>
            </div>
          </div>

          <!-- Biografía -->
          <div class="section" *ngIf="volunteerProfile.bio">
            <h3 class="section-title">{{ 'profile.bio' | translate }}</h3>
            <div class="data-item">
              <span class="data-value">{{ volunteerProfile.bio }}</span>
            </div>
          </div>

          <!-- Habilidades -->
          <div class="section" *ngIf="volunteerProfile.skills && volunteerProfile.skills.length > 0">
            <h3 class="section-title">Habilidades</h3>
            <div class="skills-container">
              <mat-chip-set>
                <mat-chip *ngFor="let skill of volunteerProfile.skills">{{ skill }}</mat-chip>
              </mat-chip-set>
            </div>
          </div>
        </div>

        <!-- Modo de edición -->
        <form *ngIf="isEditing" [formGroup]="profileForm" class="edit-form">
          <div class="section">
            <h3 class="section-title">*Datos personales</h3>
            <div class="form-grid">
              <mat-form-field appearance="fill" class="full-width">
                <mat-label>Nombre completo *</mat-label>
                <input matInput formControlName="name">
                <mat-error *ngIf="profileForm.get('name')?.hasError('required')">
                  El nombre es requerido
                </mat-error>
                <mat-error *ngIf="profileForm.get('name')?.hasError('minlength')">
                  El nombre debe tener al menos 3 caracteres
                </mat-error>
              </mat-form-field>

              <mat-form-field appearance="fill" class="full-width">
                <mat-label>Correo electrónico *</mat-label>
                <input matInput formControlName="email">
                <mat-error *ngIf="profileForm.get('email')?.hasError('required')">
                  El correo es requerido
                </mat-error>
                <mat-error *ngIf="profileForm.get('email')?.hasError('email')">
                  Ingresa un correo válido
                </mat-error>
              </mat-form-field>

              <mat-form-field appearance="fill" class="full-width">
                <mat-label>Ubicación *</mat-label>
                <input matInput formControlName="location">
                <mat-error *ngIf="profileForm.get('location')?.hasError('required')">
                  La ubicación es requerida
                </mat-error>
              </mat-form-field>

              <mat-form-field appearance="fill" class="full-width">
                <mat-label>Biografía</mat-label>
                <textarea matInput formControlName="bio" rows="4"></textarea>
                <mat-error *ngIf="profileForm.get('bio')?.hasError('maxlength')">
                  La biografía no puede exceder 500 caracteres
                </mat-error>
              </mat-form-field>

              <mat-form-field appearance="fill" class="full-width">
                <mat-label>Habilidades</mat-label>
                <input matInput formControlName="skills">
                <mat-hint>Separa las habilidades con comas</mat-hint>
              </mat-form-field>
            </div>
          </div>
        </form>
      </div>

      <!-- PERFIL DE ORGANIZACIÓN -->
      <div *ngIf="!isVolunteerMode">
        <!-- Modo de visualización -->
        <div *ngIf="!isEditing">
        <!-- Datos de la organización -->
        <div class="section">
          <h3 class="section-title">*Datos de la organización</h3>
          <div class="data-grid">
            <div class="data-item">
              <span class="data-label">Nombre:</span>
              <span class="data-value">{{ profile.organization.name }}</span>
            </div>
            <div class="data-item">
              <span class="data-label">Correo:</span>
              <span class="data-value">{{ profile.organization.email }}</span>
            </div>
            <div class="data-item">
              <span class="data-label">Ubicación:</span>
              <span class="data-value">{{ profile.organization.location }}</span>
            </div>
            <div class="data-item">
              <span class="data-label">Teléfono:</span>
              <span class="data-value">{{ profile.organization.phone }}</span>
            </div>
          </div>
        </div>

        <!-- Tipo de organización -->
        <div class="section">
          <h3 class="section-title">*Tipo de organización:</h3>
          <div class="data-item">
            <span class="data-value">{{ profile.organization.type }}</span>
          </div>
        </div>

        <!-- Datos del representante -->
        <div class="section">
          <h3 class="section-title">*Datos del representante</h3>
          <div class="data-grid">
            <div class="data-item">
              <span class="data-label">Nombre:</span>
              <span class="data-value">{{ profile.representative.name }}</span>
            </div>
            <div class="data-item">
              <span class="data-label">Correo:</span>
              <span class="data-value">{{ profile.representative.email }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Modo de edición -->
      <form *ngIf="isEditing" [formGroup]="profileForm" class="edit-form">
        <!-- Datos de la organización -->
        <div class="section">
          <h3 class="section-title">*Datos de la organización</h3>
          <div class="form-grid">
            <mat-form-field appearance="fill" class="full-width">
              <mat-label>Nombre de la organización *</mat-label>
              <input matInput formControlName="organizationName">
              <mat-error *ngIf="profileForm.get('organizationName')?.hasError('required')">
                El nombre es requerido
              </mat-error>
              <mat-error *ngIf="profileForm.get('organizationName')?.hasError('minlength')">
                El nombre debe tener al menos 3 caracteres
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="fill" class="full-width">
              <mat-label>Correo electrónico *</mat-label>
              <input matInput formControlName="organizationEmail">
              <mat-error *ngIf="profileForm.get('organizationEmail')?.hasError('required')">
                El correo es requerido
              </mat-error>
              <mat-error *ngIf="profileForm.get('organizationEmail')?.hasError('email')">
                Ingresa un correo válido
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="fill" class="full-width">
              <mat-label>Ubicación *</mat-label>
              <input matInput formControlName="organizationLocation">
              <mat-error *ngIf="profileForm.get('organizationLocation')?.hasError('required')">
                La ubicación es requerida
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="fill" class="full-width">
              <mat-label>Teléfono *</mat-label>
              <input matInput formControlName="organizationPhone">
              <mat-error *ngIf="profileForm.get('organizationPhone')?.hasError('required')">
                El teléfono es requerido
              </mat-error>
            </mat-form-field>
          </div>
        </div>

        <!-- Tipo de organización -->
        <div class="section">
          <h3 class="section-title">*Tipo de organización</h3>
          <mat-form-field appearance="fill" class="full-width">
            <mat-label>Selecciona el tipo *</mat-label>
            <mat-select formControlName="organizationType">
              <mat-option *ngFor="let type of organizationTypes" [value]="type">
                {{ type }}
              </mat-option>
            </mat-select>
            <mat-error *ngIf="profileForm.get('organizationType')?.hasError('required')">
              El tipo de organización es requerido
            </mat-error>
          </mat-form-field>
        </div>

        <!-- Datos del representante -->
        <div class="section">
          <h3 class="section-title">*Datos del representante</h3>
          <div class="form-grid">
            <mat-form-field appearance="fill" class="full-width">
              <mat-label>Nombre completo *</mat-label>
              <input matInput formControlName="representativeName">
              <mat-error *ngIf="profileForm.get('representativeName')?.hasError('required')">
                El nombre es requerido
              </mat-error>
              <mat-error *ngIf="profileForm.get('representativeName')?.hasError('minlength')">
                El nombre debe tener al menos 3 caracteres
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="fill" class="full-width">
              <mat-label>Correo electrónico *</mat-label>
              <input matInput formControlName="representativeEmail">
              <mat-error *ngIf="profileForm.get('representativeEmail')?.hasError('required')">
                El correo es requerido
              </mat-error>
              <mat-error *ngIf="profileForm.get('representativeEmail')?.hasError('email')">
                Ingresa un correo válido
              </mat-error>
            </mat-form-field>
          </div>
        </div>
      </form>
      </div>
    </mat-card-content>

    <!-- Botones de acción -->
    <mat-card-actions align="end">
      <div *ngIf="!isEditing" class="action-buttons">
        <button mat-button (click)="onUpdatePassword()">
          <mat-icon>lock</mat-icon>
          Actualizar contraseña
        </button>
        <button mat-raised-button color="primary" (click)="onEditProfile()">
          <mat-icon>edit</mat-icon>
          Editar información de perfil
        </button>
      </div>

      <div *ngIf="isEditing" class="edit-buttons">
        <button mat-button (click)="onCancelEdit()">
          <mat-icon>close</mat-icon>
          Cancelar
        </button>
        <button mat-raised-button color="primary" 
                [disabled]="!profileForm.valid || loading"
                (click)="onSaveProfile()">
          <mat-icon *ngIf="!loading">save</mat-icon>
          <span *ngIf="loading">Guardando...</span>
          <span *ngIf="!loading">Guardar cambios</span>
        </button>
      </div>
    </mat-card-actions>
  </mat-card>
</div>