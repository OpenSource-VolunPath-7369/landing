<div class="community-container" [class.volunteer-view]="isVolunteer()" [class.organization-view]="isOrganization()">
  <!-- Mensaje de éxito -->
  <div *ngIf="showSuccessMessage" class="success-message">
    <div class="success-content">
      <i class="fa-solid fa-check-circle"></i>
      <span>{{ successMessage }}</span>
    </div>
  </div>
  
  <div class="community-header">
    <h1 class="community-title">{{ 'community.title' | translate }}</h1>
    <div *ngIf="isVolunteer()" class="role-badge volunteer-badge">
      <i class="fa-solid fa-user"></i>
      <span>{{ 'community.volunteerView' | translate }}</span>
    </div>
    <div *ngIf="isOrganization()" class="role-badge organization-badge">
      <i class="fa-solid fa-building"></i>
      <span>{{ 'community.organizationView' | translate }}</span>
    </div>
  </div>
  
  <div class="community-content">
    <!-- Main Feed -->
    <div class="feed-section">
      <!-- Projects -->
      <div 
        *ngFor="let project of projects" 
        class="activity-card">
        
        <!-- Organization Header -->
        <div class="activity-header">
          <div class="organization-info">
            <img 
              [src]="project.organizationLogo" 
              [alt]="project.organizationName"
              class="organization-logo">
            <span class="organization-name">{{ project.organizationName }}</span>
          </div>
        </div>
        
        <!-- Activity Image -->
        <div class="activity-image">
          <img 
            [src]="project.image" 
            [alt]="project.description"
            class="post-image">
        </div>
        
        <!-- Activity Content -->
        <div class="activity-content">
          <div class="activity-engagement">
            <button 
              class="like-button"
              [class.liked]="project.isLiked"
              (click)="toggleLike(project)">
              <i class="fa-solid fa-heart"></i>
              <span>{{ project.likes }}</span>
            </button>
            
            <!-- Botón para Registrarse - Siempre visible para todos -->
            <button 
              class="register-button"
              (click)="registerForProject(project)"
              [disabled]="isRegistered(project.id)"
              [title]="isRegistered(project.id) ? ('community.alreadyRegisteredTooltip' | translate) : ('community.registerTooltip' | translate)">
              <i class="fa-solid fa-user-plus"></i>
              <span *ngIf="!isRegistered(project.id)">{{ 'community.register' | translate }}</span>
              <span *ngIf="isRegistered(project.id)">{{ 'community.alreadyRegistered' | translate }}</span>
            </button>
            
            <!-- Estado para VOLUNTARIOS registrados -->
            <div 
              *ngIf="isVolunteer() && isRegistered(project.id)"
              class="registration-status"
              [class.pending]="getRegistrationStatus(project.id) === 'pending'"
              [class.confirmed]="getRegistrationStatus(project.id) === 'confirmed'">
              <span *ngIf="getRegistrationStatus(project.id) === 'pending'">
                ⏳ {{ 'community.registrationStatus.pending' | translate }}
              </span>
              <span *ngIf="getRegistrationStatus(project.id) === 'confirmed'">
                ✅ {{ 'community.registrationStatus.confirmed' | translate }}
              </span>
              <span *ngIf="getRegistrationStatus(project.id) === 'cancelled'">
                ❌ {{ 'community.registrationStatus.cancelled' | translate }}
              </span>
            </div>
            
            <!-- Botón para ORGANIZACIONES: Crear actividad (opcional) -->
            <button 
              *ngIf="isOrganization()"
              class="create-button"
              (click)="viewOrganizationProfile('create')"
              style="margin-left: 10px;">
              <i class="fa-solid fa-plus"></i>
              {{ 'community.createActivity' | translate }}
            </button>
          </div>
          
          <div class="activity-description">
            <h3>{{ project.title }}</h3>
            <p>{{ project.description }}</p>
            <div class="project-info">
              <!-- Fecha y Hora -->
              <span>
                <i class="fa-solid fa-calendar"></i> 
                <span *ngIf="project.date">{{ project.date }}</span>
                <span *ngIf="!project.date && !project.time">Fecha no disponible</span>
                <span *ngIf="project.date && project.time"> {{ 'community.atTime' | translate }} </span>
                <span *ngIf="project.time">{{ project.time }}</span>
              </span>
              <!-- Lugar -->
              <span>
                <i class="fa-solid fa-map-marker-alt"></i> 
                <span *ngIf="project.location">{{ project.location }}</span>
                <span *ngIf="!project.location">Lugar no disponible</span>
              </span>
              <!-- Voluntarios -->
              <span>
                <i class="fa-solid fa-users"></i> {{ project.currentVolunteers }}/{{ project.maxVolunteers }} {{ 'community.volunteers' | translate }}
              </span>
            </div>
          </div>
        </div>
      </div>

      <!-- Publications from Dashboard -->
      <div 
        *ngFor="let publication of publications" 
        class="activity-card">
        
        <!-- Organization Header -->
        <div class="activity-header" *ngIf="getOrganizationForPublication(publication.organizationId)">
          <div class="organization-info">
            <img 
              [src]="getOrganizationForPublication(publication.organizationId)!.logo" 
              [alt]="getOrganizationForPublication(publication.organizationId)!.name"
              class="organization-logo">
            <span class="organization-name">{{ getOrganizationForPublication(publication.organizationId)!.name }}</span>
          </div>
        </div>
        
        <!-- Publication Image -->
        <div class="activity-image">
          <img 
            [src]="publication.image" 
            [alt]="publication.title"
            class="post-image">
        </div>
        
        <!-- Publication Content -->
        <div class="activity-content">
          <div class="activity-engagement">
            <button 
              class="like-button"
              (click)="toggleLikePublication(publication)">
              <i class="fa-solid fa-heart"></i>
              <span>{{ publication.likes }}</span>
            </button>
            
            <!-- Botón para Registrarse - También en Publications -->
            <button 
              class="register-button"
              (click)="registerForPublication(publication)"
              [disabled]="isRegistered(publication.id)"
              [title]="isRegistered(publication.id) ? 'Ya estás registrado' : 'Registrarse en esta actividad'">
              <i class="fa-solid fa-user-plus"></i>
              <span *ngIf="!isRegistered(publication.id)">Registrarse</span>
              <span *ngIf="isRegistered(publication.id)">Ya registrado</span>
            </button>
          </div>
          
          <div class="activity-description">
            <h3>{{ publication.title }}</h3>
            <p>{{ publication.description }}</p>
            <div class="project-info">
              <!-- Fecha y Hora -->
              <span>
                <i class="fa-solid fa-calendar"></i> 
                <span *ngIf="publication.date">{{ publication.date }}</span>
                <span *ngIf="!publication.date && !publication.time">Fecha no disponible</span>
                <span *ngIf="publication.date && publication.time"> a las </span>
                <span *ngIf="publication.time">{{ publication.time }}</span>
              </span>
              <!-- Lugar -->
              <span>
                <i class="fa-solid fa-map-marker-alt"></i> 
                <span *ngIf="publication.location">{{ publication.location }}</span>
                <span *ngIf="!publication.location">Lugar no disponible</span>
              </span>
              <!-- Voluntarios -->
              <span *ngIf="publication.maxVolunteers > 0">
                <i class="fa-solid fa-users"></i> {{ publication.currentVolunteers }}/{{ publication.maxVolunteers }} voluntarios
              </span>
            </div>
            <div *ngIf="publication.tags && publication.tags.length > 0" class="tags">
              <span *ngFor="let tag of publication.tags" class="tag">{{ tag }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Organizations Section -->
    <div class="sidebar-section">
      <div class="organizations-card">
        <h3 class="organizations-title">Organizaciones</h3>
        
        <div class="organizations-list">
          <div 
            *ngFor="let org of organizations" 
            class="organization-item"
            (click)="viewOrganizationProfile(org.id)"
            [title]="'Ver perfil de ' + org.name">
            <img 
              [src]="org.logo" 
              [alt]="org.name"
              class="org-logo">
            <span class="org-name">{{ org.name }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

